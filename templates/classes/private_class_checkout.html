{% extends 'base.html' %}
{% load static %}

{% block title %}Private Class Checkout - {{ trainer.get_full_name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/private-class-checkout.css' %}">
{% endblock %}

{% block content %}
<div class="container" style="max-width: 600px; margin: 50px auto;">
    <div class="card">
        <div class="card-header">
            <h2>Private Class Payment</h2>
        </div>
        <div class="card-body">
            <h4>{{ trainer.get_full_name }}</h4>
            
            <table class="table">
                <tr>
                    <td><strong>Trainer:</strong></td>
                    <td>{{ trainer.get_full_name }}</td>
                </tr>
                <tr>
                    <td><strong>Date:</strong></td>
                    <td>{{ pending_data.start_date }}</td>
                </tr>
                <tr>
                    <td><strong>Time:</strong></td>
                    <td>{{ pending_data.start_time }}</td>
                </tr>
                <tr>
                    <td><strong>Duration:</strong></td>
                    <td>{{ pending_data.duration_hours }} hour(s), {{ pending_data.duration_months }} month(s)</td>
                </tr>
                <tr>
                    <td><strong>Amount:</strong></td>
                    <td>Rs. {{ price }}</td>
                </tr>
                <tr style="font-size: 18px; font-weight: bold;">
                    <td><strong>Total Amount:</strong></td>
                    <td style="color: #007bff;">Rs. {{ price }}</td>
                </tr>
            </table>

            <p style="color: #666; font-size: 14px;">
                You will be redirected to eSewa payment gateway to complete your payment securely.
            </p>

            <!-- Payment Options -->
            <div class="payment-actions">
                <form action="https://rc-epay.esewa.com.np/api/epay/main/v2/form" method="POST" class="payment-form">
                    {% csrf_token %}
                    {{ form|safe }}
                    <button type="submit" class="btn btn-primary btn-lg">
                        Pay with eSewa
                    </button>
                </form>

                <form action="{% url 'khalti-initiate-private-class' %}" method="POST" class="payment-form">
                    {% csrf_token %}
                    <input type="hidden" name="return_url" value="{{ khalti_return_url }}">
                    <input type="hidden" name="website_url" value="{{ khalti_website_url }}">
                    <input type="hidden" name="amount" value="{{ khalti_amount }}">
                    <input type="hidden" name="purchase_order_id" value="{{ khalti_order_id }}">
                    <input type="hidden" name="purchase_order_name" value="{{ khalti_order_name }}">
                    <button type="submit" class="btn btn-khalti btn-lg">
                        Pay with Khalti
                    </button>
                </form>
            </div>

            <div class="payment-cancel">
                <a href="{% url 'book-private-class' %}" class="btn btn-secondary btn-lg">
                    Cancel
                </a>
            </div>

            <!-- Demo Payment Option (for testing when eSewa is unavailable) -->
            <div style="margin-top: 20px; padding: 15px; background-color: #fff3cd; border-radius: 4px; border: 1px solid #ffc107;">
                <p style="margin: 0 0 10px 0; color: #856404; font-size: 14px;">
                    <strong>Testing Mode:</strong> If eSewa is unavailable, use demo payment to test the flow.
                </p>
                <form method="POST" action="{% url 'book-private-class-details' trainer.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="duration_hours" value="{{ pending_data.duration_hours }}">
                    <input type="hidden" name="duration_months" value="{{ pending_data.duration_months }}">
                    <input type="hidden" name="start_date" value="{{ pending_data.start_date }}">
                    <input type="hidden" name="start_time" value="{{ pending_data.start_time }}">
                    <input type="hidden" name="demo_payment" value="true">
                    <button type="submit" class="btn btn-warning" style="background-color: #ffc107; color: #000;">
                        Demo Payment (Skip eSewa)
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}
