{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Dashboard - TrainWise{% endblock %}

{% block body_class %}class="hide-navbar"{% endblock %}

{% block extra_css %}
<style>
/* Stats Grid and Cards */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-lg);
    margin-bottom: var(--space-2xl);
}

.stat-card {
    background: white;
    border-radius: 0.75rem;
    padding: var(--space-xl);
    text-align: center;
    border: 2px solid rgba(16, 185, 129, 0.2);
    box-shadow: 0 2px 12px rgba(16, 185, 129, 0.08);
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 24px rgba(16, 185, 129, 0.15);
    border-color: var(--primary);
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: var(--space-sm);
    line-height: 1;
}

.stat-label {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    display: inline-block;
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
}

/* Enhanced admin sections */
.admin-section {
    position: relative;
}

.admin-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 0;
    background: linear-gradient(180deg, var(--primary), var(--primary-light));
    transition: height 0.3s ease;
    border-radius: 2px;
}

.admin-section:hover::before {
    height: 100%;
}

/* Enhanced quick actions */
.quick-actions a {
    position: relative;
    overflow: hidden;
}

.quick-actions a::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.5s ease, height 0.5s ease;
}

.quick-actions a:hover::before {
    width: 300px;
    height: 300px;
}
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container admin-dashboard">
    {% include 'admin/components/sidebar_nav.html' %}

    <main class="dashboard-main">
        <div class="dashboard-header">
            <h1>Admin Dashboard</h1>
            <p>System Overview & Management</p>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{ total_users }}</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ active_members }}</div>
                <div class="stat-label">Active Members</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ total_trainers }}</div>
                <div class="stat-label">Active Trainers</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ active_subscriptions }}</div>
                <div class="stat-label">Active Subscriptions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">â‚¹{{ total_revenue|floatformat:0 }}</div>
                <div class="stat-label">Total Revenue</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ pending_payments }}</div>
                <div class="stat-label">Unpaid Payments</div>
            </div>
        </div>

        <!-- Management Sections -->
        <div class="admin-grid">
            <div class="admin-section">
                <h2>User Management</h2>
                <div class="quick-actions">
                    <a href="{% url 'admin-members' %}?role=member" class="btn btn-primary">Manage Members</a>
                    <a href="{% url 'admin-trainers' %}?role=trainer" class="btn btn-primary">Manage Trainers</a>
                    <a href="{% url 'admin-trainer-add' %}" class="btn btn-secondary">Add New Trainer</a>
                </div>
            </div>

            <div class="admin-section">
                <h2>Class Management</h2>
                <div class="quick-actions">
                    <a href="{% url 'admin-private-classes-list' %}" class="btn btn-primary">View Classes</a>
                </div>
            </div>

            <div class="admin-section">
                <h2>Membership Plans</h2>
                <div class="quick-actions">
                    <a href="{% url 'admin-memberships' %}" class="btn btn-primary">Manage Plans</a>
                </div>
            </div>

            <div class="admin-section">
                <h2>Payments & Revenue</h2>
                <div class="quick-actions">
                    <a href="{% url 'admin-payments' %}" class="btn btn-primary">View Payments</a>
                </div>
            </div>
        </div>

        <!-- Recent Bookings -->
        <div class="admin-section">
            <h2>Recent Class Bookings</h2>
            <div class="table-responsive">
                <table class="admin-table" data-dt-paging="false" data-dt-length="false">
                    <thead>
                        <tr>
                            <th>Member</th>
                            <th>Trainer</th>
                            <th>Schedule</th>
                            <th>Duration (hrs)</th>
                            <th>Months</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for booking in recent_bookings %}
                            <tr>
                                <td>{{ booking.member.get_full_name }}</td>
                                <td>{% if booking.trainer %}{{ booking.trainer.get_full_name }}{% else %}-{% endif %}</td>
                                <td>{{ booking.start_date|date:"M d, Y" }} {{ booking.start_time|time:"H:i" }} - {{ booking.end_time|time:"H:i" }}</td>
                                <td>{{ booking.duration_hours }}</td>
                                <td>{{ booking.duration_months }}</td>
                                <td>
                                    {% if booking.is_active %}
                                        <span class="badge badge-active">Active</span>
                                    {% else %}
                                        <span class="badge badge-inactive">Inactive</span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% empty %}
                            <tr><td colspan="6" class="text-center">No recent bookings</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Recent Payments -->
        <div class="admin-section">
            <h2>Recent Payments</h2>
            <div class="table-responsive">
                <table class="admin-table" data-dt-paging="false" data-dt-length="false">
                    <thead>
                        <tr>
                            <th>Payment ID</th>
                            <th>User</th>
                            <th>Amount</th>
                            <th>Method</th>
                            <th>Status</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for payment in recent_payments %}
                            <tr>
                                <td>#{{ payment.id }}</td>
                                <td>
                                    {% if payment.member_subscription %}
                                        {{ payment.member_subscription.member.get_full_name }}
                                    {% elif payment.private_class %}
                                        {{ payment.private_class.member.get_full_name }}
                                    {% endif %}
                                </td>
                                <td>${{ payment.amount }}</td>
                                <td>{{ payment.payment_method }}</td>
                                <td><span class="badge badge-{{ payment.payment_status|lower }}">{{ payment.payment_status }}</span></td>
                                <td>{{ payment.payment_date|date:"M d, Y H:i" }}</td>
                            </tr>
                        {% empty %}
                            <tr><td colspan="6" class="text-center">No recent payments</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- System Health -->
        <div class="admin-section">
            <h2>System Health</h2>
            <div class="health-items">
                <div class="health-item">
                    <span>Database</span>
                    <span class="status status-healthy">Operational</span>
                </div>
                <div class="health-item">
                    <span>Payment Gateway</span>
                    <span class="status status-healthy">Connected</span>
                </div>
            </div>
        </div>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/admin-dashboard.js' %}"></script>
{% endblock %}
