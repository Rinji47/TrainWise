<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Admin Report - TrainWise</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; color: #333; }
        h1, h2 { text-align: center; margin-bottom: 10px; }
        .stats-grid { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 25px; justify-content: center; }
        .stat-card { background: #f8f8f8; border-radius: 8px; padding: 10px 15px; text-align: center; min-width: 120px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .stat-value { font-size: 1.3rem; font-weight: 600; }
        .stat-label { font-size: 0.85rem; color: #555; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 25px; }
        th, td { border: 1px solid #ddd; padding: 6px 8px; text-align: left; font-size: 0.9rem; }
        th { background: #f2f2f2; }
        .badge { padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; color: white; }
        .badge-active { background-color: #22c55e; }
        .badge-inactive { background-color: #6b7280; }
        .badge-paid { background-color: #22c55e; }
        .badge-pending { background-color: #f59e0b; }
        .badge-failed { background-color: #ef4444; }
        .back-btn { display: inline-block; margin-bottom: 15px; padding: 6px 12px; background: #3b82f6; color: white; text-decoration: none; border-radius: 4px; }
        .back-btn:hover { background: #2563eb; }
    </style>
</head>
<body>

    <h1>Admin Report</h1>
    <p style="text-align:center;">Generated on: {{ now|date:"M d, Y H:i" }}</p>

    <!-- Stats Grid -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">{{ total_users|default:0 }}</div>
            <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ active_members|default:0 }}</div>
            <div class="stat-label">Active Members</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ total_trainers|default:0 }}</div>
            <div class="stat-label">Trainers</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ active_subscriptions|default:0 }}</div>
            <div class="stat-label">Active Subscriptions</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">₹{{ total_revenue|default:0 }}</div>
            <div class="stat-label">Total Revenue</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ pending_payments|default:0 }}</div>
            <div class="stat-label">Unpaid Payments</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ failed_payments|default:0 }}</div>
            <div class="stat-label">Failed Payments</div>
        </div>
    </div>

    <!-- Recent Bookings -->
    <h2>Recent Class Bookings</h2>
    <table>
        <thead>
            <tr>
                <th>Member</th>
                <th>Trainer</th>
                <th>Schedule</th>
                <th>Duration (hrs)</th>
                <th>Months</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for booking in recent_bookings|slice:":5" %}
            <tr>
                <td>{{ booking.member.get_full_name }}</td>
                <td>{% if booking.trainer %}{{ booking.trainer.get_full_name }}{% else %}-{% endif %}</td>
                <td>{{ booking.start_date|date:"M d, Y" }} {{ booking.start_time|time:"H:i" }} - {{ booking.end_time|time:"H:i" }}</td>
                <td>{{ booking.duration_hours }}</td>
                <td>{{ booking.duration_months }}</td>
                <td>
                    {% if booking.is_active %}
                        <span class="badge badge-active">Active</span>
                    {% else %}
                        <span class="badge badge-inactive">Inactive</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="6" style="text-align:center;">No recent bookings</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Recent Payments -->
    <h2>Recent Payments</h2>
    <table>
        <thead>
            <tr>
                <th>Payment ID</th>
                <th>User</th>
                <th>Amount</th>
                <th>Method</th>
                <th>Status</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            {% for payment in recent_payments|slice:":5" %}
            <tr>
                <td>#{{ payment.id }}</td>
                <td>
                    {% if payment.member_subscription %}
                        {{ payment.member_subscription.member.get_full_name }}
                    {% elif payment.private_class %}
                        {{ payment.private_class.member.get_full_name }}
                    {% endif %}
                </td>
                <td>₹{{ payment.amount }}</td>
                <td>{{ payment.payment_method }}</td>
                <td>
                    {% if payment.payment_status|lower == 'completed' %}
                        <span class="badge badge-paid">Paid</span>
                    {% elif payment.payment_status|lower == 'pending' %}
                        <span class="badge badge-pending">Unpaid</span>
                    {% else %}
                        <span class="badge badge-failed">{{ payment.payment_status }}</span>
                    {% endif %}
                </td>
                <td>{{ payment.payment_date|date:"M d, Y H:i" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="6" style="text-align:center;">No recent payments</td></tr>
            {% endfor %}
        </tbody>
    </table>

</body>
</html>
